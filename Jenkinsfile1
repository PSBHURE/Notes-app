pipeline {
    agent { label 'Production_Server' }

    stages {

        stage('User Approval') {
            steps {
                script {
                    // Prompt user for action
                    def userChoice = input(
                        message: 'What do you want to do?',
                        parameters: [
                            choice(name: 'ACTION', choices: ['Container-UP', 'Container-DOWN'], description: 'Select an action')
                        ]
                    )
                    env.ACTION = userChoice
                }
            }
        }

        stage('Execute Docker compose Action') {
            steps {
                script {
                    if (env.ACTION == 'Container-UP') {
                        echo "✅ Containers are going to start..."
        stage('Docker image scanning by Trivy') {
			steps {
				sh "docker pull pratikbhure/notes-app"
				sh "trivy image --format table -o trivy-image-report.html pratikbhure/notes-app"
			}
		}
							sh "docker compose up -d"
					

                    } else if (env.ACTION == 'Container-DOWN') {
                        echo "⚠️ Containers are going to stop..."
                            sh "docker compose down"
                            


                    } else {
                        error("❌ Invalid action selected: ${env.ACTION}")
                    }
                }
            }
        }
    }
}
